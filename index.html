<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>ESP Projeto V2 Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body { font-family: Arial; margin: 20px; }
.card { border: 1px solid #ccc; padding: 10px; margin: 10px; display: inline-block; width: 150px; }
</style>
</head>
<body>
<h1>Dashboard ESP</h1>

<div id="ultimo" class="card">Última leitura: ---</div>
<canvas id="historico" width="600" height="300"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyC_98m8YaKIe3QHXtNH39B8TVGWTE-vI4U",
  authDomain: "SEU_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://esp-projeto-5d4b2-default-rtdb.firebaseio.com/",
  projectId: "SEU_PROJECT_ID",
  storageBucket: "SEU_PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Referências
const ultimoRef = db.ref("/ultimo");
const historicoRef = db.ref("/historico");

// Cards
const ultimoDiv = document.getElementById("ultimo");

// Gráfico
const ctx = document.getElementById("historico").getContext("2d");
const chart = new Chart(ctx, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'Histórico', data: [], borderColor: 'blue', fill: false }] },
    options: { responsive: true, scales: { y: { beginAtZero: true } } }
});

// Última leitura
ultimoRef.on("value", snapshot => {
    const val = snapshot.val();
    if(val) ultimoDiv.innerHTML = "Última leitura: " + JSON.stringify(val);
});

// Histórico
historicoRef.on("child_added", snapshot => {
    const val = snapshot.val();
    chart.data.labels.push(new Date().toLocaleTimeString());
    chart.data.datasets[0].data.push(val.double); // ou ajuste para o campo que quiser
    chart.update();
});
</script>
</body>
</html>
