<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESP-Projeto-V2 Dashboard</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>

<!-- Firebase JS SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
.sensor-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04);
    transition: all 0.3s;
}
</style>
</head>
<body class="bg-gray-50">

<!-- Header -->
<div id="vanta-bg" class="relative h-64 md:h-80 lg:h-96 w-full overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-b from-blue-900/50 to-blue-600/30"></div>
    <div class="container mx-auto px-6 relative z-10 h-full flex flex-col justify-center items-center">
        <h1 class="text-4xl md:text-5xl font-bold text-white" data-aos="fade-down">ESP-Projeto-V2 Dashboard</h1>
        <p class="text-xl text-white opacity-90 text-center max-w-2xl mt-2" data-aos="fade-up" data-aos-delay="200">
            Monitoramento em tempo real dos sensores conectados
        </p>
    </div>
</div>

<!-- Últimos valores -->
<div class="container mx-auto px-6 py-12">
<div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 mb-12">
    <div class="sensor-card bg-white rounded-xl shadow-md p-6 transition-all duration-300" data-aos="fade-up">
        <h3 class="text-lg font-semibold text-gray-700">Bool</h3>
        <h2 id="bool" class="text-3xl font-bold text-gray-800">-</h2>
    </div>
    <div class="sensor-card bg-white rounded-xl shadow-md p-6 transition-all duration-300" data-aos="fade-up" data-aos-delay="50">
        <h3 class="text-lg font-semibold text-gray-700">Umidade %</h3>
        <h2 id="int" class="text-3xl font-bold text-gray-800">-</h2>
    </div>
    <div class="sensor-card bg-white rounded-xl shadow-md p-6 transition-all duration-300" data-aos="fade-up" data-aos-delay="100">
        <h3 class="text-lg font-semibold text-gray-700">Temperatura *C</h3>
        <h2 id="float" class="text-3xl font-bold text-gray-800">-</h2>
    </div>
    <div class="sensor-card bg-white rounded-xl shadow-md p-6 transition-all duration-300" data-aos="fade-up" data-aos-delay="150">
        <h3 class="text-lg font-semibold text-gray-700">Double</h3>
        <h2 id="double" class="text-3xl font-bold text-gray-800">-</h2>
    </div>
    <div class="sensor-card bg-white rounded-xl shadow-md p-6 transition-all duration-300" data-aos="fade-up" data-aos-delay="200">
        <h3 class="text-lg font-semibold text-gray-700">Condição de Chuva no Momento</h3>
        <h2 id="string" class="text-3xl font-bold text-gray-800">-</h2>
    </div>
    <div class="sensor-card bg-white rounded-xl shadow-md p-6 transition-all duration-300" data-aos="fade-up" data-aos-delay="250">
        <h3 class="text-lg font-semibold text-gray-700">Ultima Atualização</h3>
        <h2 id="timestamp" class="text-3xl font-bold text-gray-800">-</h2>
    </div>
</div>

<!-- Mini-gráficos Int, Float, Double -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
    <div class="bg-white rounded-xl shadow-md p-6" data-aos="fade-up">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Int History</h2>
        <canvas id="intChart" height="200"></canvas>
    </div>
    <div class="bg-white rounded-xl shadow-md p-6" data-aos="fade-up">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Float History</h2>
        <canvas id="floatChart" height="200"></canvas>
    </div>
    <div class="bg-white rounded-xl shadow-md p-6" data-aos="fade-up">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Double History</h2>
        <canvas id="doubleChart" height="200"></canvas>
    </div>
</div>
</div>

<!-- Footer -->
<footer class="bg-gray-800 text-white py-8">
<div class="container mx-auto px-6 text-center">
    <p>© 2025 ESP-Projeto-V2. Todos os direitos reservados.</p>
</div>
</footer>

<script>
AOS.init();
feather.replace();

VANTA.GLOBE({
    el: "#vanta-bg",
    mouseControls: true,
    touchControls: true,
    gyroControls: false,
    minHeight: 200.00,
    minWidth: 200.00,
    scale: 1.00,
    scaleMobile: 1.00,
    color: 0x3a86ff,
    backgroundColor: 0x111827,
    size: 1.00
});

// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyC_98m8YaKIe3QHXtNH39B8TVGWTE-vI4U",
  authDomain: "esp-projeto-5d4b2.firebaseapp.com",
  databaseURL: "https://esp-projeto-5d4b2-default-rtdb.firebaseio.com",
  projectId: "esp-projeto-5d4b2",
  storageBucket: "esp-projeto-5d4b2.firebasestorage.app",
  messagingSenderId: "1094472612847",
  appId: "1:1094472612847:web:ea237814e34e519836141a"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const ROOT_NODE = "ESP-Projeto-V2";
const latestRef = db.ref(ROOT_NODE + "/ultimo");
const historyRef = db.ref(ROOT_NODE + "/historico");

// Atualiza cards
latestRef.on('value', snapshot => {
    const data = snapshot.val();
    if (!data) return;
    document.getElementById("bool").innerText = data.bool;
    document.getElementById("int").innerText = data.int;
    document.getElementById("float").innerText = parseFloat(data.float).toFixed(2);
    document.getElementById("double").innerText = parseFloat(data.double).toFixed(5);
    document.getElementById("string").innerText = data.string;
    const ts = new Date(data.timestamp);
    document.getElementById("timestamp").innerText = ts.toLocaleString();
    document.getElementById("lastUpdate").innerText = ts.toLocaleTimeString();
});

// Inicializa gráficos
const intCtx = document.getElementById('intChart').getContext('2d');
const floatCtx = document.getElementById('floatChart').getContext('2d');
const doubleCtx = document.getElementById('doubleChart').getContext('2d');

const intChart = new Chart(intCtx, { type:'line', data:{ labels:[], datasets:[{label:'Int', data:[], borderColor:'blue', fill:false, tension:0.3 }] }, options:{ responsive:true }});
const floatChart = new Chart(floatCtx, { type:'line', data:{ labels:[], datasets:[{label:'Float', data:[], borderColor:'green', fill:false, tension:0.3 }] }, options:{ responsive:true }});
const doubleChart = new Chart(doubleCtx, { type:'line', data:{ labels:[], datasets:[{label:'Double', data:[], borderColor:'red', fill:false, tension:0.3 }] }, options:{ responsive:true }});

// Atualiza gráficos
historyRef.on('value', snapshot => {
    const data = snapshot.val();
    if (!data) return;
    const labels = [], ints=[], floats=[], doubles=[];
    for(const key in data){
        labels.push(new Date(data[key].timestamp).toLocaleTimeString());
        ints.push(data[key].int);
        floats.push(data[key].float);
        doubles.push(data[key].double);
    }
    intChart.data.labels = labels; intChart.data.datasets[0].data = ints; intChart.update();
    floatChart.data.labels = labels; floatChart.data.datasets[0].data = floats; floatChart.update();
    doubleChart.data.labels = labels; doubleChart.data.datasets[0].data = doubles; doubleChart.update();
});
</script>

</body>
</html>
